@*
 * Copyright 2023 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import uk.gov.hmrc.govukfrontend.views.html.components.GovukPhaseBanner
@import uk.gov.hmrc.hmrcfrontend.views.html.components._
@import cats.syntax.eq._
@import cats.instances.string._
@import uk.gov.hmrc.hmrcfrontend.config.TudorCrownConfig
@import uk.gov.hmrc.hmrcfrontend.views.Aliases.Header
@import uk.gov.hmrc.govukfrontend.views.html.helpers.GovukLogo

@this(hmrcBanner: HmrcBanner, govukPhaseBanner: GovukPhaseBanner, tudorCrownConfig: TudorCrownConfig, govukLogo: GovukLogo)

@(params: Header)
@import params._
<header role="banner">

  <div class="govuk-header @toClasses("hmrc-header", params.classes) @if(signOutHref.exists(_.nonEmpty) || languageToggle.exists(_.linkMap.nonEmpty)){ hmrc-header--with-additional-navigation}else{}" data-module="govuk-header"
    @toAttributes(attributes)>
    <div class="@toClasses("govuk-header__container ", containerClasses)">
      <div class="govuk-header__logo">
        <a href="@homepageUrl" class="govuk-header__link govuk-header__link--homepage">
          @govukLogo(
            useRebrand = true,
            useTudorCrown = true,
            useLogotype = true,
            svgClass = "govuk-header__logotype",
            ariaLabelText = Some("GOV.UK")
          )
          @productName match {
            case Some(NonEmptyString(x)) => {
              <span class="govuk-header__product-name">
              @x
              </span>
            }
            case _ => {}
          }
        </a>
      </div>



      @if(serviceName.exists(_.nonEmpty) || signOutHref.exists(_.nonEmpty) || (navigation.getOrElse(Seq.empty).nonEmpty) || languageToggle.exists(_.linkMap.nonEmpty)) {
        <div class="govuk-header__content">
          @serviceNameLinkOrSpan(serviceName, serviceUrl)

          @if(navigation.getOrElse(Seq.empty).nonEmpty) {
            <nav class="govuk-header__navigation" aria-label="Top Level Navigation">
              <button type="button" class="govuk-header__menu-button govuk-js-header-toggle" aria-controls="navigation" aria-label="Show or hide Top Level Navigation">Menu</button>
              <ul id="navigation" class="@toClasses("govuk-header__navigation-list", navigationClasses)">
              @for(item <- navigation.getOrElse(Seq.empty).filter(item => item.content.nonEmpty)) {
                <li class="govuk-header__navigation-item@if(item.active){ govuk-header__navigation-item--active}else{}">
                  @if(item.href.exists(_.nonEmpty)) {
                    <a class="govuk-header__link" href="@item.href" @toAttributes(item.attributes)>
                    }
                  @item.content.asHtml
                  @if(item.href.exists(_.nonEmpty)) {
                  </a>
                  }
                </li>
              }
              </ul>
            </nav>
          } else {}

          @(signOutHref, languageToggle.map(_.linkMap)) match {
            case (Some(NonEmptyString(s)), _) => {
              <nav class="hmrc-sign-out-nav">
                <a class="govuk-link hmrc-sign-out-nav__link" href="@s">
                @language match {
                  case Cy => {Allgofnodi}
                  case _ => {Sign out}
                }
                </a>
              </nav>
            }
            case (_, Some(linkMap)) if linkMap.nonEmpty => {
              <nav class="hmrc-language-select" aria-label="Choose a language">
                <ul class="govuk-list hmrc-language-select__items">
                @for((lang, link) <- linkMap) {
                  <li class="govuk-header__navigation-item">
                    <a @if(lang.code === language.code){aria-current="page"}else{class="govuk-header__link"}
                    lang="@lang.code" hreflang="@lang.code" href="@link">@lang.name</a>
                  </li>
                }
                </ul>
              </nav>
            }
            case _ => {}
          }
        </div>
      } else {}
    </div>
  </div>

  @phaseBanner.map { pb =>
    <div class="govuk-width-container">
      @govukPhaseBanner(pb)
    </div>
  }
  @if(displayHmrcBanner){
    <div class="govuk-width-container">
    @hmrcBanner(Banner(language))
    </div>
  }
  @additionalBannersBlock
</header>

@serviceNameLinkOrSpan(serviceName: Option[String], serviceUrl: String) = {
@serviceName match {
  case Some(NonEmptyString(s)) => {
    @serviceUrl match {
      case NonEmptyString(_) => { <a href="@serviceUrl" class="hmrc-header__service-name hmrc-header__service-name--linked">@s</a> }
      case _ => { <span class="hmrc-header__service-name ">@s</span> }
    }
  }
  case _ => {}
}
}